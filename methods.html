

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Supplementary Bioinformatics Methods &#8212; My Jupyter Book</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .secondtoggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">My Jupyter Book</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="_sources/methods.md.txt"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.md</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Source interaction buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
            <div class="dropdown-buttons sourcebuttons">
                <a class="repository-button" href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left" title="Source repository"><i class="fab fa-github"></i>repository</button></a>
                <a class="issues-button" href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fmethods.html&body=Your%20issue%20content%20here."><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left" title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
                
            </div>
        </div>
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#environment-setup" class="nav-link">Environment setup</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#sequence-data-preparation" class="nav-link">Sequence data preparation</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="supplementary-bioinformatics-methods">
<h1>Supplementary Bioinformatics Methods<a class="headerlink" href="#supplementary-bioinformatics-methods" title="Permalink to this headline">¶</a></h1>
<p><strong>NOTE: this is a work in progress</strong></p>
<div class="section" id="environment-setup">
<h2>Environment setup<a class="headerlink" href="#environment-setup" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">env</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">az</span><span class="o">-</span><span class="n">covid</span><span class="o">-</span><span class="mi">1</span> <span class="o">--</span><span class="n">file</span> <span class="n">environment</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div>
<div class="section" id="sequence-data-preparation">
<h2>Sequence data preparation<a class="headerlink" href="#sequence-data-preparation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ md5sum Global_allsequences_2020-04-16.fasta
98834fc11a1de1f2ce265c4f36b8531b  Global_allsequences_2020-04-16.fasta

$ md5sum nextstrain-metadata.tsv
1751d2b16e5fa9d62b7f8f8e17bd68dc  nextstrain-metadata.tsv
</pre></div>
</div>
<p>Clean up GISAID sequences</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ az-covid-1/gisaid-cleanup.py Global_allsequences_2020-04-16.fasta gisaid-unaligned.fasta
Count read: 9230
Count discarded (contains spaces): 408
Count discarded (&gt;10% N): 163
Count written: 8659
</pre></div>
</div>
<p>Sample GISAID sequences over time</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ az-covid-1/subsample-time.py --rate 7,7 --hist time-hist.pdf nextstrain-metadata.tsv time-sampled.tsv
Subsampled 9841 down to 106 samples.

$ az-covid-1/filter-seqs.py --tsv time-sampled.tsv gisaid-unaligned.fasta time-sampled.fasta
For 106 ids to keep, 97 were found out of 8659 total samples
</pre></div>
</div>
<p>Create a single file containing the TGEN/AZ sequences, the Genbank reference
sequence (NC_045512.2), and the time-sampled GISAID sequences to create our
“reference set” of sequences we know we want to include.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat tgen-unaligned.fasta reference-genome.fasta time-sampled.fasta &gt; reference-centroids.fasta
</pre></div>
</div>
<p>Search GISAID sequences against the “reference set”, to identify close
matches for all reference sequences. This ensures that for all sequences that
we plan to include, we have their nearest neighbors. This protects against
artificial monophylies. Store the unmatched GISAID sequences from this step
for de novo clustering.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vsearch --threads 28 --usearch_global gisaid-unaligned.fasta --id 0.9999 --db reference-centroids.fasta --uc reference-search-results-0.9999.uc --qmask none --output_no_hits --notmatched unmatched-0.9999.fasta
</pre></div>
</div>
<p>Cluster the unmatched GISAID sequences de novo at multiple different percent
identity thresholds. This allows us to sample the diversity of the SARS-CoV-2
genomes. We will identify the output that we want to use based on the number
of sequences obtained from that search. Note that the 2nd through 5th de novo
clustering commands are clustering the output of the 1st de novo clustering
command to reduce runtime of each.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vsearch --threads 28 --cluster_fast unmatched-0.9999.fasta --id 0.9999 --qmask none --xsize --uc unmatched-0.9999.uc --centroids denovo-centroids-0.9999.fasta

$ vsearch --threads 28 --cluster_fast denovo-centroids-0.9999.fasta --id 0.9995 --qmask none --xsize --uc unmatched-0.9995.uc --centroids denovo-centroids-0.9995.fasta

$ vsearch --threads 28 --cluster_fast denovo-centroids-0.9999.fasta --id 0.9990 --qmask none --xsize --uc unmatched-0.9990.uc --centroids denovo-centroids-0.9990.fasta

$ vsearch --threads 28 --cluster_fast denovo-centroids-0.9999.fasta --id 0.9950 --qmask none --xsize --uc unmatched-0.9950.uc --centroids denovo-centroids-0.9950.fasta

$ vsearch --threads 28 --cluster_fast denovo-centroids-0.9999.fasta --id 0.9900 --qmask none --xsize --uc unmatched-0.9900.uc --centroids denovo-centroids-0.9900.fasta
</pre></div>
</div>
<p>We will sample the remaining SARS-CoV-2 diversity at 99.9% identity threshold
as 48 sequences were obtained at that threshold, which is about the number we
expect will be reasonable to use with BEAST.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ grep -c &#39;^&gt;&#39; denovo-centroids-0.99*.fasta
denovo-centroids-0.9900.fasta:9
denovo-centroids-0.9950.fasta:11
denovo-centroids-0.9990.fasta:48
denovo-centroids-0.9995.fasta:106
denovo-centroids-0.9999.fasta:1869
</pre></div>
</div>
<p>For each TGEN/AZ sequence, select up to its three closest matches based on
the global alignment search.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ az-covid-1/sample-clusters.py --query gisaid-unaligned.fasta --uc reference-search-results-0.9999.uc --target tgen-unaligned.fasta --n 3 --tsv nextstrain-metadata.tsv tgen-unaligned-sampled-clusters.tsv

$ az-covid-1/filter-seqs.py --tsv tgen-unaligned-sampled-clusters.tsv gisaid-unaligned.fasta mrca-centroids-siblings.fasta
</pre></div>
</div>
<p>Count the number of sequences in each of our sequence collections. Then merge
them to create the sequence collection we plan to use for this analysis.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ grep -c &quot;^&gt;&quot; reference-centroids.fasta mrca-centroids-siblings.fasta denovo-centroids-0.9990.fasta
reference-centroids.fasta:174
mrca-centroids-siblings.fasta:244
denovo-centroids-0.9990.fasta:48
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat reference-centroids.fasta mrca-centroids-siblings.fasta denovo-centroids-0.9990.fasta &gt; unaligned-preprint-seqs.fasta
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ grep -c &quot;^&gt;&quot; unaligned-preprint-seqs.fasta
466
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ md5sum unaligned-preprint-seqs.fasta*
6506af95df6c4c3b8671489418b6773f  unaligned-preprint-seqs.fasta
e801322e946c1b81782a2d6b962be15e  unaligned-preprint-seqs.fasta.gz
</pre></div>
</div>
<p>Brendan identified sequences to exclude based on low quality alignments or
missing metadata. He also requested some specific sequences be added. These
additions and subtractions result in the data used for our analyses.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ az-covid-1/clean-seqs.py --remove brendans-ids-to-drop.tsv --fix-date True unaligned-preprint-seqs.fasta unaligned-cleaned-preprint-seqs-2020-04-28.fasta
54 sequences were duplicated, 37 were removed, and 71 were renamed out of 466 total.

$ grep -c &#39;^&gt;&#39; unaligned-cleaned-preprint-seqs-2020-04-28.fasta
375

$ grep -A 1 EPI_ISL_407215 gisaid-unaligned.fasta &gt;&gt; unaligned-cleaned-preprint-seqs-2020-04-28.fasta

$ grep -A 1 EPI_ISL_406223 gisaid-unaligned.fasta &gt;&gt; unaligned-cleaned-preprint-seqs-2020-04-28.fasta

$ grep -A 1 EPI_ISL_424671 gisaid-unaligned.fasta &gt;&gt; unaligned-cleaned-preprint-seqs-2020-04-28.fasta

$ grep -A 1 EPI_ISL_424668 gisaid-unaligned.fasta &gt;&gt; unaligned-cleaned-preprint-seqs-2020-04-28.fasta

$ grep -c &#39;^&gt;&#39; unaligned-cleaned-preprint-seqs-2020-04-28.fasta
379
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gzip -c unaligned-cleaned-preprint-seqs-2020-04-28.fasta &gt; unaligned-cleaned-preprint-seqs-2020-04-28.fasta.gz

$ md5sum unaligned-cleaned-preprint-seqs-2020-04-28.fasta*
07bce6efa67969113c46dc91597e367b unaligned-cleaned-preprint-seqs-2020-04-28.fasta
8bef74159d699415023b829efbd6670d unaligned-cleaned-preprint-seqs-2020-04-28.fasta.gz
</pre></div>
</div>
<p>An additional five genomes sequenced at TGEN were added following this
workflow as these were assembled following the execution of this workflow.
These sequences are ids:
TGEN-CoV-AZ-WMTS-TG268002|Coconino|2020-03-16
TGEN-CoV-AZ-WMTS-TG271878|UNKNOWN|2020-03-20
TGEN-CoV-AZ-WMTS-TG268099|Coconino|2020-03-17
TGEN-CoV-AZ-WMTS-TG271862|Cochise|2020-03-22
TGEN-CoV-AZ-WMTS-TG271435|Coconino|2020-03-2</p>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>